server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;

    # Live HLS: make playlists refresh aggressively
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;

    # CORS (handy for testing in browsers)
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS" always;
    add_header Access-Control-Allow-Headers "*" always;

    types {
        application/vnd.apple.mpegurl m3u8;
        video/mp2t ts;
        application/dash+xml mpd;
        video/iso.segment m4s;
    }

    location / {
        autoindex off;
        try_files $uri =404;
    }

    location ~ \.m3u8$ {
        add_header Content-Type application/vnd.apple.mpegurl;
        sendfile off;      # helps playlist freshness on bind mounts
        expires -1;
    }

    location ~ \.(ts|m4s)$ {
        add_header Content-Type video/mp2t;
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        aio off;
        expires 5s;        # tiny cache is fine for segments
    }
}